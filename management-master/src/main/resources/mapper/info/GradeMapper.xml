<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.school.management.mapper.info.GradeMapper">

    <resultMap type="Grade" id="GradeResult">
        <id     property="gradeId"          column="grade_id"      />
        <result property="gradeName"        column="grade_name"   />
        <result property="leader"           column="user_id"    />
        <result property="leaderName"       column="user_name"    />
        <result property="gradeNum"         column="grade_num"        />
        <result property="classNum"         column="class_num"  />
        <result property="createTime"   column="create_time"  />
    </resultMap>

    <update id="updateGradeLeader" parameterType="Grade">
        update grade
        <set>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            <if test="leader != null and leader != ''">leader = #{leader},</if>
            update_time = sysdate()
        </set>
        where id = #{gradeId}
    </update>

    <select id="selectGradeList" resultMap="GradeResult">
    SELECT g.id grade_id, g.create_time, g.grade_name, g.grade_num, count( c.id ) class_num, u.user_name FROM grade g, USER u, class c
    WHERE g.leader = u.user_id AND c.grade_id = g.id GROUP BY g.id order by grade_num
    </select>

</mapper>