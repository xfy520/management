<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.school.management.mapper.MenuMapper">
	<resultMap type="Menu" id="MenuResult">
		<id     property="menuId"         column="menu_id"        />
		<result property="menuName"       column="menu_name"      />
		<result property="parentId"       column="parent_id"      />
		<result property="orderNum"       column="order_num"      />
		<result property="url"            column="url"            />
		<result property="menuType"       column="menu_type"      />
		<result property="visible"        column="visible"        />
		<result property="perms"          column="perms"          />
		<result property="icon"           column="icon"           />
		<result property="remark"         column="remark"         />
		<result property="target"         column="target"         />
	</resultMap>

	<select id="selectMenusByUserId" parameterType="String" resultMap="MenuResult">
		select distinct m.id menu_id, m.parent_id, m.menu_name, m.url, 'menuItem' target, ifnull(m.perms,'') as perms, m.menu_type, m.icon, m.order_num
		from menu m where m.menu_type in ('M', 'C') AND FIND_IN_SET ( (SELECT GROUP_CONCAT( DISTINCT ( u.perms ) ) FROM USER u WHERE u.id = #{Id}), m.perms ) > 0  order by m.parent_id, m.order_num
	</select>
</mapper> 