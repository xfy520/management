<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('单独新增考生')" />
    <th:block th:include="include :: select2-css" />
</head>
<body>
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-add-examine">
        <div class="form-group" style="text-align:center">
            <div>
                <select name="studentId" class="form-control m-b" id="studentId">
                </select>
            </div>
        </div>
    </form>
</div>
<th:block th:include="include :: footer" />
<th:block th:include="include :: select2-js" />
<script th:inline="javascript">

    var prefix = ctx + "info/examine";

    $(function() {
        toSelect2();
    });

    function toSelect2() {
        $("#studentId").select2({
            ajax: {
                url : prefix + '/search',
                async: true,
                delay: 500,
                dataType : 'json',
                type : 'post',
                data : function (params) {
                    return {
                        userId : params.term,
                        examId: parent.$("#examId").val(),
                        classId: parent.$("#classId option:selected").val(),
                        subjectId: parent.$("#subjectId option:selected").val()
                    };
                },
                processResults: function (data) {
                    var options = new Array();
                    if (data.total != 0) {
                        $(data.rows).each(function(i, o) {
                            console.log(o)
                            options.push({
                                id : o.id,
                                text : o.userName,
                                title: o.userName + '  ' + o.userId
                            });
                        });
                        return {
                            results: options
                        };
                    }else{
                        return {
                            results: options
                        };
                    }
                },
                cache: true
            },
            placeholder: "输入学生学号搜索...",
            allowClear: true,
            minimumInputLength: 1,
            multiple: false,
            escapeMarkup: function (markup) { return markup; }, // 字符转义处理自定义格式化防止xss注入
            formatSelection: function formatRepoSelection(repo){return repo.text;} // 函数用于呈现当前的选择
        });
    }

    function submitHandler() {
        var data = $("#form-add-examine").serializeArray();
        data.push({"name": "examId", "value": parent.$("#examId").val()});
        data.push({"name": "subjectId", "value": parent.$("#subjectId option:selected").val()});
        $.operate.save(ctx + "info/examine/insert", data);
    }
</script>
</body>
</html>